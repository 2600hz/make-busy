```
           `                                                                        
           .'.``                                                                    
           ,...`                                                                    
           .'...`         ``                                                        
            ;,@#.       ;;'';:`                                                     
            `,,#,`     ;;,,,:;:.`                                                   
             ',,+.   `';::  ;:':`                                                   
             `::+,` ,;:,,; : ,,':.                                                  
              +.+'.;;,:` ::` ,,,;,.`                                                
             ..:'+;'`:..,:,;:,,,,;:.                                                
              :,'';`,: ;.. .,,,,,,;:.                                               
               ,':``:,:,;`:.,.:,,.,;:`                                              
              ;',:`:,,. ,,.: :`,,,,,',`                                             
             ';::.`:,.`::,,.; ,,:,,:,;.`                                            
            ;:,:: ;,.,;,`:.:`:; `,:..::`                                            
           `;,: ;:`.`.,,.,`;.,;``::.,,;,`                                           
           .:,: .:;`:.,:```,:,` ,``:`,,:.                                           
           +;,:`  :,.:`:;:,`,:,..:`;:,,:,`                                          
           #;:::';,,:  `,, ,`;:,``;: ,,,:,`                                         
           #,':,,,,,`' ;::' ;, :,:;,`,.,:,.                                         
           `;,',,,,,: :.,`,,`.. ,,  `:,,:;,`                                        
            +,,;,::.:,`;`,,:'..,`,,.:,,::;#.                                        
            `#,.',,,,,: ,; .,;, :`:,,,,:;;,,`                                       
           ` .+:.'::`:::,., :,:: :.,:,:;;;,;.                                       
              ;::,;,:.,::` ;,.:,;,.::;:;;;;'.                                       
               +:,,;,,,.::,.' :,:,#.;:;;;;#::`                                      
               `#:,,;:,:`,: .`:,::,;;;;;##+::.                                      
                `#:::;::,,,;..,,,,:;;;'#+#'';,                                      
                 `#:::,',:,.,,,,,;;;;++#@'+;;:`                                     
                  .#;;:,';:,,:::;:;;+++#+;+++;.                                     
                   .+'::::;;;;;::;:+++#+'''':',`                                    
                   ``++::::;:.,:::++++++';';';'.                                    
                     `;+;:;;;::,:'+###++;;.+'':'`                                   
                      `:+';;;;::.,+,:+++:,:,#''',`                                  
                       `.++;;;;;':;'++'::::,.';:',`                                 
                         .:+#;;:;++'+++#,,..,,'+;;.`                                
                          `.;+#;:++++#+++.`.:,,#;;+,`                               
                            `.:#+:'+++++++.. ,,:++;'.                               
                              `.:#;'+++#++#. .,,:';''.`                             
                ,`              .,++:;++##+#,` ::;;''',`                            
                ::.               `:@:'+#+++#,:`:,;':++:`                           
                :,.                `,#:'+##+'#,, ..;';''+++`                        
                .;,`                `,#;'##'+'+,, :,;;;;;'''#`                      
                 `,.                 `,@;'+##+'+,,,,:;;;'''+'#.                     
                 ,@,`                 `:#;'+#++;+.,;''';';;;'''':`                  
                ` ::`                  `:+;'+++#'';';';+#;'''';'';`                 
                 .;''+``             `  `''+'#++'''''''';;;;''';+',                 
                '':;;;'.`           .'++''';+'#++''''';;'';''';+'''.                
                .';;:;:',`        '@.+#####+:'+#++'''''@;@;+''''''''.`              
   ,``           ';;:;;;'.`      @+######+##@'+#+++';;''+;#;;;;'''';'.              
    ..`          ';::;;';:`      :#+#'+##''++'+#+++'';'+#`'''';''';'';`             
    ::.          ';;;;';::`     '#+#+#''#'+'#'+##++'';''`@ +;;''''+#+',`            
   ``,..         ,';;';;;,`     +'+@''#;@+';:#+#'##+++''':+;''''''+#@':`            
     `.#.        `'';;;;,`       #:;#:@;#+;:+#;'##+++''+'';';'''++##+';.            
      :`:;':.     ',';;,`        #::;::#+::.'+;'##+++++''''''''++##+'+;,`           
      ``';';;;;`  :;;;,`        `;'##+#+:,`:#:+;+##++++''''''++###+'',',`           
      .#+'';'''#` `';;.          #,,,+;:,` ',,#;;###++++++'++++##++;:,+,`           
       @++';''##,` ':',           +++::,` `+:.`';'#'#+++++++++++#+;:,:#,`           
       `++'';'++:` +;',`          `.`,.`  ',,``#;'+##++++++++++++:;:::;,`           
        ++'''#';,` .';:`           ```    ;..` .+''+###++++++++#;'+;:#:.            
        `@+++##;.   ':;.                  +,.  `#;''+###++@'+++;;'#+#;:`            
         .++#';.`   ':+,                `+.,`   `#:;;'#+:;@+++,;#+++;:.             
         `@++#:`    ;;+,`               :++:`    .@:;;'+,'''';:#++++@,`             
           #'+;`    .';:`               #+#:`   ``:#:;;;;'';:::;+++++,.             
           .#;#.    `;+:`             `,#+;,`     `,#:';;':::::;+;++'++;.',.'`      
           `.#:@.`  `.+,`             `#++:.       `,#;:;,::::+#;:,:;;++''++'''#.`` 
           ``;#;#.    +,`              #+;,`         ,;#';:;+#';,.`.,;';;+;,;::;'.  
             `'+;;`   `;`             :`::.           `,'+';;;:,`    `,,,,,...'::@. 
              `##',`   :,`            '',``            `.,+',,.`      ``````#;,,.#.`
               `@#+,   `;:`          +',.`               `.+';#'.` `  `;++:...,``#.`
               `.##;`   `.+.`      `#+:,`                  `:+.`.```.``...`..```,..`
                ``,;'`   `.+`     ,@+,:,`                   `.@,````````````  ` '.. 
                  `.`..,,:;;+#'',`.+::.`                     ``#:`         ` ` @`.` 
                     ``.`...,,++#',,,.`                        .,#,           @`.`  
                            ``.,,.,.``                        ` ``,@,`       +`.`   
                               ````                               `..+#'``.#`..`    
                                                                    ``......`.`     
                                                                      ````..`       
```

## About

MakeBusy is a functional test suite for Kazoo. It works by creating test accounts in specified Kazoo cluster using Kazoo HTTP REST API and
performing test calls to Kazoo cluster with separate automated FreeSwitch instances. Kazoo entities are used to store arbitrary information
required for testing and generation of FreeSwitch configuration.

## Components

To run tests you'll requite one Makebusy instance serving XML configs for automated FreeSwitch instances via HTTP, and at least 3
FreeSwitch instances (to act as device, carrier and pbx substitutes).

## FreeSwitch automation

FreeSwitch instances are automated by providing generated XML configs for SIP endpoints (acting as device, carrier or external pbx),
and by issuing commands to FreeSwitch control socket (port 8021 usually). Therefore FreeSwitch and Makebusy instances must be visible
to each other (tcp port 8021 and 80), and in addition, FreeSwitch instances must have SIP and RTP access to Kazoo cluster, and Makebusy
must have access to Kazoo REST HTTP API.

## Docker images

MakeBusy comprises of 4 Docker images: makebusy, makebusy-fs-auth, makebusy-fs-pbx and makebusy-fs-carrier, where makebusy-fs-* are
automated FreeSwitch images (what, in turn, are based on kazoo/freeswitch docker image).

## How to run tests

### Environemt variables

Clear (and re-create) Kazoo config before running test, FreeSwitch profile is also restarted:
```
CLEAN=1 ./run-test path_to_test.php
```

(Re)Register existing profile before running tests:
```
REGISTER_PROFILE=1 ./run-test path_to_test.php
```

Restart existing profile before running tests:
```
RESTART_PROFILE=1 ./run-test path_to_test.php
```

Dump FreeSwitch events content to MakeBusy log file:
```
DUMP_EVENTS=1 ./run-test path_to_test.php
```

Log messages to console also:
```
LOG_CONSOLE=1 ./run-test path_to_test.php
```

## How to develop and debug tests

## Configuration file (and notes)

A valid configuration file config.json must exist in MakeBusy root folder (see etc/config.json as example).

## TODO

1. Somehow indicate a dirty state after test (e.g. env should be re-created)?
2. Language bs is not found (voicemail tests, trying to say user name)
3. Speed-up redirect to voicemail in voicemail tests
4. Somehow sync with Kazoo events (e.g. voicemail stored and is available)
5. Review and add more basic test cases (e.g. call between accounts, federation?)
6. Don'do hupall, select and drop account channels (forge channel uuid/track channels)?
7. Reset Voicemailbox to initial state, more sane way
